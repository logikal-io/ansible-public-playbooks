- name: Create installation folder
  ansible.builtin.file: path=~/.local/share state=directory

- name: Install Terraform environment manager
  ansible.builtin.git:
    repo: https://github.com/tfutils/tfenv.git
    dest: ~/.local/share/tfenv
    version: '{{ tfenv_version }}'

- name: Install Terragrunt environment manager
  ansible.builtin.git:
    repo: https://github.com/cunymatthieu/tgenv.git
    dest: ~/.local/share/tgenv
    version: '{{ tgenv_version }}'

- name: Install Terragrunt Commons
  ansible.builtin.git:
    repo: '{{ _github_repo_url }}logikal-io/terragrunt-commons.git'
    dest: ~/.terragrunt
    version: '{{ terragrunt_commons_version }}'

- name: Create TFLint folder
  become: true
  ansible.builtin.file: path=/opt/tflint state=directory

- name: Install TFLint
  become: true
  ansible.builtin.unarchive:
    src: '{{ _tflint_endpoint }}/{{ tflint_version }}/tflint_linux_amd64.zip'
    dest: /opt/tflint
    remote_src: true

- name: Create Terraform plugin cache folder
  ansible.builtin.file: path=~/.terraform.d/plugin-cache state=directory

- name: Install Bash config
  ansible.builtin.copy: src=terraform.bashrc dest=~/.bashrc.d/

- name: Set GitHub Actions environment
  ansible.builtin.shell: >
    echo "$HOME/.local/share/tfenv/bin:$HOME/.local/share/tgenv/bin:/opt/tflint" >> $GITHUB_PATH
  when: _github_actions
